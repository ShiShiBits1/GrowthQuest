{% extends "base.html" %}

{% block title %}给孩子添加积分{% endblock %}

{% block content %}
<h1>给孩子添加积分</h1>

<form method="POST">
    <div class="form-group">
        <label for="child_id">选择孩子</label>
        <select id="child_id" name="child_id" required>
            <option value="" disabled selected>请选择孩子</option>
            {% for child in children %}
                <option value="{{ child.id }}">{{ child.name }} (当前积分: {{ child.points }})</option>
            {% endfor %}
        </select>
    </div>
    
    <div class="form-group">
        <label for="task_id">选择任务</label>
        <select id="task_id" name="task_id" required>
            <option value="" disabled selected>请选择任务</option>
            {% for task in tasks %}
                <option value="{{ task.id }}" data-points="{{ task.points }}">{{ task.name }} ({{ task.category }})</option>
            {% endfor %}
        </select>
    </div>
    
    <div class="form-group">
        <label for="points_display">奖励积分</label>
        <input type="number" id="points_display" readonly placeholder="选择任务后显示积分">
    </div>
    
    <div class="form-group">
        <label for="date">日期时间</label>
        <input type="datetime-local" id="date" name="date" value="{{ today }}" required>
    </div>
    
    <button type="submit" class="button">添加积分</button>
</form>

<script>
    // 实现任务选择与积分的联动功能
    document.getElementById('task_id').addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        const points = selectedOption.getAttribute('data-points');
        document.getElementById('points_display').value = points;
    });
    
    // 页面加载时，如果已有任务选中，显示对应的积分
    window.addEventListener('load', function() {
        const taskSelect = document.getElementById('task_id');
        if (taskSelect.value) {
            const selectedOption = taskSelect.options[taskSelect.selectedIndex];
            const points = selectedOption.getAttribute('data-points');
            document.getElementById('points_display').value = points;
        }
    });
</script>
{% endblock %}