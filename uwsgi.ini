[uwsgi]
# 项目目录（根据宝塔面板标准路径配置）
chdir=/www/wwwroot/成长奖励系统

# 指定项目application入口文件
wsgi-file=/www/wwwroot/成长奖励系统/run.py

# python 程序内用以启动的application 变量名
callable=app

# 进程个数（根据服务器性能调整）
processes=4

# 线程个数（每个进程的线程数）
threads=2

# 指定启动时的pid文件路径（宝塔面板需要）
pidfile=/www/wwwroot/成长奖励系统/uwsgi.pid

# 指定ip及端口（关键配置：确保能接受所有网络接口的连接）
# 使用socket模式以提高性能，宝塔面板通常使用这种方式
http=0.0.0.0:8086

# 增加监听队列长度
listen=100

# 启动uwsgi的用户名和用户组（宝塔面板标准用户）
uid=www
gid=www

# 启用主进程
master=true

# 设置请求超时时间（秒）
timeout=300

# 设置缓冲区大小（字节）
buffer-size=65536

# 后台运行并输出日志（宝塔面板日志路径规范）
daemonize=/www/wwwlogs/python/成长奖励系统/uwsgi.log

# 启用详细的HTTP日志
http-timeout=300

# 启用详细请求日志格式
log-format=%(addr) - %(user) [%(ltime)] %(method) %(uri) %(proto) %(status) %(size) %(referer) %(uagent)

# 启用详细的uWSGI日志
disable-logging=False
log-master=True

# 确保正确处理HTTP头
socket-timeout=300

# 启用HTTP标头解析调试
env=PYTHONUNBUFFERED=1

# 设置Python路径
env=PYTHONPATH=/www/wwwroot/成长奖励系统

# 启用uWSGI的HTTP路由模块
http-raw-body=True

# 适应Linux环境的特殊配置
thunder-lock=True
# 增加超时设置以适应网络环境
harakiri=300
# 确保日志直接写入文件，避免缓冲
logfile-chmod=644
# 自动重新加载（仅开发环境使用，生产环境建议注释）
# py-autoreload=1

# 限制每个worker处理的请求数，防止内存泄漏
buffer-size=65536

# 增加max-requests以防止内存泄漏
max-requests=5000
# 优雅重载时等待的最大时间（秒）
graceful-timeout=30

# 确保正确设置Python解释器路径
# 宝塔面板通常在这个路径下
executable=/www/server/pyporject/成长奖励系统/bin/python