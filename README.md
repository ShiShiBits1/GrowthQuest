# 小孩成长奖励系统

一个基于Flask框架的小孩成长奖励系统，使用SQLite作为数据库，支持多种部署方式，包括开发环境运行和生产环境uWSGI部署。

## 功能特点

- 用户认证（登录/登出）
- 孩子管理（添加、查看、编辑）
- 任务管理（创建任务、设置积分、分类管理）
- 奖励管理（创建奖励、设置积分消耗）
- 任务完成记录和积分确认
- 奖励兑换功能
- 数据保存在本地SQLite数据库
- 荣誉墙功能（展示孩子成就）
- 任务分类管理

## 安装与运行

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 初始化数据库

```bash
python init_db.py
```

这将创建数据库表并初始化一个默认管理员账户：
- 用户名: admin
- 密码: admin123

### 3. 运行应用

#### 开发环境运行

```bash
python run.py
```

应用将在端口8086上运行，您可以通过浏览器访问：`http://localhost:8086`

如果在NAS上运行，可以通过NAS的IP地址访问：`http://<NAS_IP>:8086`

#### 生产环境部署（uWSGI）

项目已配置uWSGI支持，可通过以下命令启动：

```bash
uwsgi --ini uwsgi.ini
```

默认配置下，应用将在端口8086上运行，可通过以下地址访问：`http://<服务器IP>:8086`

## 项目结构

```
成长奖励系统/
├── app/
│   ├── __init__.py    # Flask应用初始化
│   ├── models.py      # 数据库模型
│   ├── main/
│   │   ├── __init__.py  # 蓝图初始化
│   │   └── views.py     # 视图函数
│   └── templates/     # HTML模板
├── requirements.txt   # 依赖列表
├── run.py             # 开发环境应用入口
├── wsgi.py            # 生产环境WSGI入口
├── uwsgi.ini          # uWSGI配置文件
├── init_db.py         # 数据库初始化脚本
├── data.sqlite        # SQLite数据库文件（运行后生成）
├── local_access_test.py  # 本地访问测试工具
├── network_diagnostics.py # 网络诊断工具
└── DEPLOYMENT_GUIDE.md # 部署指南文档
```

## 使用说明

1. 登录系统（使用默认管理员账户或创建新账户）
2. 添加孩子信息
3. 创建任务分类（可选）
4. 创建任务和奖励
5. 孩子完成任务后，家长确认并发放积分
6. 孩子可以使用积分兑换奖励
7. 查看荣誉墙了解孩子成就

## 生产环境配置

### uWSGI配置

uWSGI配置文件(`uwsgi.ini`)已针对生产环境进行了优化，包括：

- 绑定到0.0.0.0，允许外部访问
- 配置多个进程和线程以提高性能
- 设置超时和缓冲区大小
- 详细的日志记录
- 用户权限设置

## 问题排查

项目包含多个诊断工具，用于排查部署和访问问题：

1. **网络诊断**：`python network_diagnostics.py`
2. **本地访问测试**：`python local_access_test.py`
3. **应用测试**：`python test_app.py`

详细的问题排查指南请参考`DEPLOYMENT_GUIDE.md`。

## 数据分析功能

系统提供了强大的数据分析功能，帮助家长全面了解孩子的成长情况和任务完成趋势。

### 数据分析仪表盘

在导航栏中点击"数据分析"进入仪表盘，您可以查看：

- **概览卡片**：展示当前积分、任务完成率、勋章数量和最长连续完成天数
- **任务分类分布**：以环形图展示不同分类任务的分布情况
- **积分获取趋势**：折线图展示近期积分获取变化趋势
- **任务连续完成情况**：展示各任务的连续完成天数和状态
- **习惯养成趋势**：展示最近7天的任务完成数量趋势
- **勋章统计**：按等级分布和最近获得的勋章展示

### 详细数据分析页面

仪表盘各模块都有"查看详情"按钮，可以进入更详细的分析页面：

#### 1. 任务分析
- 完整的任务分类分布图
- 任务完成趋势按周/月/年展示
- 未完成任务提醒和优先级建议

#### 2. 积分分析
- 详细的积分获取记录
- 积分趋势图表（可按不同时间范围查看）
- 积分使用分析（任务完成vs奖励兑换）

#### 3. 勋章分析
- **勋章概览**：已获得/未获得勋章数量统计
- **获取趋势**：按月展示勋章获得趋势
- **类型分布**：按勋章类型和等级的分布分析
- **最近获得**：最近获得的勋章详细信息
- **接近获得**：最接近获得条件的未获得勋章提示
- **全部收藏**：所有可获取勋章的完整列表

#### 4. 习惯养成分析
- **连续天数统计**：每个任务的连续完成情况
- **时间线展示**：按日期展示任务完成记录
- **习惯养成进度**：基于21天习惯养成理论的进度分析
- **推荐任务**：基于完成情况的个性化任务推荐

### 使用提示

1. **时间范围选择**：右上角可切换查看最近7天、30天或90天的数据
2. **孩子切换**：如有多个孩子，可在左上角切换查看不同孩子的数据
3. **数据更新**：页面顶部显示数据更新时间，确保信息及时
4. **交互式图表**：所有图表支持悬停查看详细数据，点击图例可切换显示/隐藏数据系列
5. **移动端适配**：数据分析功能已针对手机和平板进行优化，确保在各种设备上都有良好的使用体验

## 注意事项

- 为了安全起见，建议在生产环境中修改默认密码
- 数据库文件data.sqlite会在首次运行时自动生成，请定期备份
- 生产环境部署时，请确保正确配置uWSGI和反向代理设置
- 定期检查日志文件，及时发现和解决问题
- 如需修改端口或其他配置，请参考uwsgi.ini和DEPLOYMENT_GUIDE.md
- 数据分析功能使用Chart.js进行图表渲染，确保浏览器支持较新版本的JavaScript